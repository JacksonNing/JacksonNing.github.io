<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>C学习心得(一) | 既以歌声惊天下 何必起舞乱芳华</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">C学习心得(一)</h1><a id="logo" href="/.">既以歌声惊天下 何必起舞乱芳华</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Inicio</i></a><a href="/archives/"><i class="fa fa-archive"> Archivo</i></a><a href="/about/"><i class="fa fa-user"> Acerca de</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">C学习心得(一)</h1><div class="post-meta">Mar 22, 2019</div><div class="post-content"><h3 id="编辑器的选择和学习资料"><a href="#编辑器的选择和学习资料" class="headerlink" title="编辑器的选择和学习资料"></a>编辑器的选择和学习资料</h3><ul>
<li>window平台 Visual Studi、 Eclipse+CDT+MinGW CodeBlocks</li>
<li>mac平台 CLion&amp;Xcode</li>
<li>linux平台 CLion&amp;原生编译tools GCC + vim</li>
<li><a href="https://en.cppreference.com/w/" target="_blank" rel="noopener">https://en.cppreference.com/w/</a> </li>
<li><a href="https://gitee.com/lionsoul/projects" target="_blank" rel="noopener">https://gitee.com/lionsoul/projects</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/cpp/index.html#SEC_Contents" target="_blank" rel="noopener">https://gcc.gnu.org/onlinedocs/cpp/index.html#SEC_Contents</a></li>
</ul>
<h3 id="C基础回顾"><a href="#C基础回顾" class="headerlink" title="C基础回顾"></a>C基础回顾</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  //预编译处理命令</span></span></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> a,b,sum; <span class="comment">/*定义变量a,b，sum为整型变量*/</span></span><br><span class="line">    a=<span class="number">20</span>; <span class="comment">/*把整数20赋值给整型变量a*/</span></span><br><span class="line">    b=<span class="number">15</span>; <span class="comment">/*把整数15赋值给整型变量b*/</span></span><br><span class="line">    sum=a+b; <span class="comment">/*把两个数之和赋值给整型变量sum*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a=%d,b=%d,sum=%d\n"</span>,a,b,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>变量名：</p>
<ul>
<li>标识符只能由字母、数字、下划线组成</li>
<li>标识符的第一个字母必须是字母和下划线</li>
<li>标识符区分大小写字母，如If和if是两个完全不同的标识符</li>
<li>不能使用关键字（32个）</li>
</ul>
<p>变量本质：</p>
<ul>
<li>程序通过变量来申请和命名内存空间 int a = 0，通过变量名访问内存空间。</li>
<li>修改变量有几种方法？直接/间接（指针修改）</li>
<li>变量三要素（名称、大小、作用域）</li>
</ul>
<p>关键字：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto break case char union do double else enum extern goto if int long short signed static</span><br><span class="line">sizof struct switch unsigned void for while typedef continue float return typedef default</span><br></pre></td></tr></table></figure>
<p>C语言技能树：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fx7ozhm0l3j31ga1mn1f0.jpg" alt="C语言技能树大全"></p>
<p>C语言数据类型：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fx7puyi5nfj30g50apjrv.jpg" alt="img"></p>
<p>C语言的格式输出：%d %ld %lld %c %f %lf %u %x %u %o %s 自己复习整理下</p>
<p>%u unsigned short </p>
<p>常量：记住宏常量(符号常量) #define PI 3.1415926</p>
<p>​            字符串常量 char str[] = “ABCD”；</p>
<p>​            const int a = 100;</p>
<p> c99 定义了boolean，但是它不是基本类型。int就可以表示boolean  需要引入 #include &lt;stdbool.h&gt;</p>
<p><strong><em>TIPS</em></strong>:</p>
<ul>
<li>void<em> 代表指针地址存储的类型可以多种。 C语言规定只有相同类型的指针才可以相互赋值 void</em> 指针作为左值用于“接收”任意类型的指针, void* 指针作为右值赋值给其它指针时需要强制类型转换</li>
<li>数据类型本质是固定内存大小的别名。大小计算用sizeof，数据类型的封装一般我们使用void *</li>
<li>可以给已存在的数据类型起别名typedef</li>
<li>我们在开始中一般建议使用重载的int32_t,在不同的操作系统使用sizeof表达式</li>
</ul>
<h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><p>一般我们对于内存的分类也就这几种：栈区（stack area）、堆区（heap area）、全局区（静态区）（存放全局变量与静态变量static）、BSS段（存放未初始化的全局变量，未初始化的全局变量默认值为0）、文字常量区、数据区（data area）、代码区（code area）等。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fz78bmtwvcj30bq0b4aae.jpg" alt="内存"></p>
<p>代码理解：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> num1;<span class="comment">/*BSS段*/</span></span><br><span class="line"><span class="keyword">int</span> num2 = <span class="number">20</span>;<span class="comment">/*全局区*/</span></span><br><span class="line"><span class="keyword">char</span> * str1 = <span class="string">"str1"</span>;<span class="comment">/*文字常量区*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,getpid());<span class="comment">/*获取当前进程id号*/</span></span><br><span class="line">    <span class="keyword">int</span> num3 = <span class="number">3</span>;<span class="comment">/*栈区*/</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> num4 = <span class="number">4</span>;<span class="comment">/*全局区*/</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> num5 = <span class="number">5</span>;<span class="comment">/*栈区*/</span></span><br><span class="line">    <span class="keyword">char</span> * str2 = <span class="string">"str2"</span>;<span class="comment">/*文字常量区*/</span></span><br><span class="line">    <span class="keyword">char</span> str3[] = <span class="string">"str3"</span>;<span class="comment">/*栈区*/</span></span><br><span class="line">    <span class="keyword">int</span> * p = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="number">0</span>));<span class="comment">/*&amp;p在栈区，p在堆区*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"num1:%p\nnum2:%p\nnum3:%p\nnum4:%p\nnum5:%p\n"</span>,&amp;num1,&amp;num2,&amp;num3,&amp;num4,&amp;num5);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"str1:%p\nstr2:%p\nstr3:%p\n"</span>,str1,str2,str3);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"&amp;p:%p\np:%p\n"</span>,&amp;p,p);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;&#125;<span class="comment">/*死循环以保证进程不会结束，方便查看/proc/pid/maps文件*/</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vim /proc/process id/maps</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fz78u46rogj31hq0kg45d.jpg" alt="image-20190115141654181"></p>
<p>备注：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一列代表内存段的虚拟地址</span><br><span class="line">第二列代表执行权限，p=私有 s=共享 heap和stack段不应该有x</span><br><span class="line">第三列代表在进程地址里的偏移量</span><br><span class="line">第四列映射文件的主设备号和次设备号 通过 cat /proc/devices得知fd</span><br><span class="line">第五列映像文件的节点号，即inode</span><br><span class="line">第六列是映像文件的路径</span><br><span class="line">补充资料：https://www.cnblogs.com/jiayy/p/3458076.html</span><br></pre></td></tr></table></figure>
<p>首先看代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> <span class="keyword">int</span> var1 = <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">int</span> var2 = <span class="number">2</span>;</span><br><span class="line">    test1();</span><br><span class="line">&#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> var2 = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"hello, world!\n"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fxacvb62p9j30uo0d4whg.jpg" alt="image-20181117001228977"></p>
<p>不同的OS看到的红色圈圈可能不一样。可执行文件在存储（也就是还没有载入到内存中）的时候，分为：代码区、数据区和未初始化数据区3个部分。下图所示为可执行代码存储时结构和运行时结构的对照图。一个正在运行着的C编译程序占用的内存分为代码区、初始化数据区、未初始化数据区、堆区和栈区5个部分。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fxacx3sh3tj30wc0lktcl.jpg" alt="image-20181117001411911"></p>
<ul>
<li><p>代码区（text segment）。代码区指令根据程序设计流程依次执行，对于顺序指令，则只会执行一次（每个进程），如果反复，则需要使用跳转指令，如果进行递归，则需要借助栈来实现。代码段： 代码段（code segment/text segment ）通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。代码区的指令中包括操作码和要操作的对象（或对象地址引用）。如果是立即数（即具体的数值，如5），将直接包含在代码中；如果是局部数据，将在栈区分配空间，然后引用该数据地址；如果是BSS区和数据区，在代码中同样将引用该数据地址。另外，代码段还规划了局部数据所申请的内存空间信息。</p>
</li>
<li><p>全局初始化数据区/静态数据区（Data Segment）。只初始化一次。数据段： 数据段（data segment ）通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配。data段中的静态数据区存放的是程序中已初始化的全局变量、静态变量和常量。</p>
</li>
<li><p>未初始化数据区（BSS）。在运行时改变其值。BSS 段： BSS 段（bss segment ）通常是指用来存放程序中未初始化的全局变量的一块内存区域。BSS 是英文Block Started by Symbol 的简称。BSS 段属于静态内存分配，即程序一开始就将其清零了。一般在初始化时BSS段部分将会清零。</p>
</li>
<li><p>栈区（stack）。由编译器自动分配释放，存放函数的参数值、局部变量的值等。存放函数的参数值、局部变量的值，以及在进行任务切换时存放当前任务的上下文内容。其操作方式类似于数据结构中的栈。每当一个函数被调用，该函数返回地址和一些关于调用的信息，比如某些寄存器的内容，被存储到栈区。然后这个被调用的函数再为它的自动变量和临时变量在栈区上分配空间，这就是C实现函数递归调用的方法。每执行一次递归函数调用，一个新的栈框架就会被使用，这样这个新实例栈里的变量就不会和该函数的另一个实例栈里面的变量混淆。栈(stack) ：栈又称堆栈， 是用户存放程序临时创建的局部变量，也就是说我们函数括弧”{}”中定义的变量（但不包括static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出特点，所以栈特别方便用来保存/ 恢复调用现场。从这个意义上讲，我们可以把堆栈看成一个寄存、交换临时数据的内存区。</p>
</li>
<li><p>堆区（heap）。用于动态内存分配。堆在内存中位于bss区和栈区之间。一般由程序员分配和释放，若程序员不释放，程序结束时有可能由OS回收。堆(heap)： 堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）。在将应用程序加载到内存空间执行时，操作系统负责代码段、数据段和BSS段的加载，并将在内存中为这些段分配空间。栈段亦由操作系统分配和管理，而不需要程序员显示地管理；堆段由程序员自己管理，即显式地申请和释放空间。</p>
</li>
</ul>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxad0v2v4kj30z00sq796.jpg" alt="image-20181117001749452"></p>
<p><strong><em>思考</em></strong>：我们的c的函数是如何像操作系统申请内存的？和jvm游什么区别？</p>
<p><a href="https://www.gnu.org/software/libc/" target="_blank" rel="noopener">https://www.gnu.org/software/libc/</a></p>
<p><a href="https://www.gnu.org/software/libc/manual/pdf/libc.pdf" target="_blank" rel="noopener">https://www.gnu.org/software/libc/manual/pdf/libc.pdf</a></p>
<p>我们一般使用malloc来分配内存，属于c标准库函数。malloc分配的内存是从堆中分配的。linux系统向用户提供申请的内存有brk(sbrk)和mmap函数。</p>
<p>案列1：手动分析代码在内存分布</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* memory_allocate.c用于演示内存分布情况 */</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> a = <span class="number">0</span>;                      <span class="comment">/* a在全局已初始化数据区 */</span></span><br><span class="line">  <span class="keyword">char</span> *p1;                       <span class="comment">/* p1在BSS区(未初始化全局变量) */</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b;                        <span class="comment">/* b在栈区 */</span></span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">"abc"</span>;             <span class="comment">/* s为数组变量, 存储在栈区 */</span></span><br><span class="line">    <span class="comment">/* "abc"为字符串常量, 存储在已初始化数据区 */</span></span><br><span class="line">   <span class="keyword">char</span> *p1, p2;                 <span class="comment">/* p1、p2在栈区 */</span></span><br><span class="line">   <span class="keyword">char</span> *p3 = <span class="string">"123456"</span>;          <span class="comment">/* "123456\0"已初始化在数据区, p3在栈区 */</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> c = <span class="number">0</span>;             <span class="comment">/* c为全局(静态)数据, 存在于已初始化数据区 */</span></span><br><span class="line">   <span class="comment">/* 另外, 静态数据会自动初始化 */</span></span><br><span class="line">   p1 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">10</span>);      <span class="comment">/* 分配的10个字节的区域存在于堆区 */</span></span><br><span class="line">   p2 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">20</span>);      <span class="comment">/* 分配得来的20个字节的区域存在于堆区 */</span></span><br><span class="line">   </span><br><span class="line">   <span class="built_in">free</span>(p1);</span><br><span class="line">   <span class="built_in">free</span>(p2);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<p><img src="/2019/03/22/C学习心得-一/Users/wuyue/Library/Application Support/typora-user-images/image-20181211133018829.png" alt="image-20181211133018829"></p>
<p>进程内存布局：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fz9efro70dj30tg0o6dxq.jpg" alt="image-20190117110150437"></p>
<p>作业：brk mmap 看源码分析</p>
<p>动态内存申请总结：</p>
<p><strong>malloc</strong><br>    没有初始化内存的内容,一般调用函数memset来初始化这部分的内存空间.free（）</p>
<p><strong>calloc</strong><br>    申请内存并将初始化内存数据为null.</p>
<p>​     <code>int *pn = (int*)calloc(10, sizeof(int));</code></p>
<p><strong>realloc</strong></p>
<p>​     对malloc申请的内存进行大小的调整.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *a = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">realloc</span>(a,<span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>特别的：<br><strong>alloca</strong><br>    在栈申请内存,因此无需释放.<br><code>int *p = (int *)alloca(sizeof(int) * 10);</code></p>
<p>面试题目：malloc(0)； 将返回什么？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* p = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参见代码  动态内存分配.c</p>
<h3 id="内存四区模型增加"><a href="#内存四区模型增加" class="headerlink" title="内存四区模型增加"></a>内存四区模型增加</h3><p>void指针含义：</p>
<p>  ==c语言规定只有相同数据类型的指针才可以相互赋值==，因此void<em>指针作为左值用于“接收”任意类型的指针。void</em>指针作为右值赋值给其他指针时，需要进行强制类型转换。</p>
<p>变量：</p>
<p>既能读又能写的内存对象，我们称为变量；一旦初始化后不能修改的对象我们称之为常量。变量名实质是一段连续内存空间的别名。</p>
<p>内存四区：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0wmk5h4vbj312i0l0wlq.jpg" alt="image-20190309163109690"></p>
<h3 id="数组和指针"><a href="#数组和指针" class="headerlink" title="数组和指针"></a>数组和指针</h3><p><code>数组</code>：int a[5];</p>
<p>数组是内存中一组连续的空间，上面的数组a是内存中连续的5个int型的空间。这段空间在数组初始化的时候就开辟出来了。数组名a就是这段连续空间的起始地址，同时也是第一个元素的地址。相当于&amp;a[0]。下标表示了每个元素的具体位置，同时也表示这个元素与第一个元素之间的距离。于是a[i]相当于a[0 + i]。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.c first.c</span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">5</span>];<span class="comment">//数组下标从0开始的，a【5】是不存在的。为什么从0开始计数呢？数组的大小也不能动态的定义，编译器是不识别的</span></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    a[i] = i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d "</span>, a[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tips:一定要关注数据在内存中保存的基本形式，比如int a[100],那么int 4个字节，100*4是不是开辟了400个字节的内存空间。搞明白数组的引用和数组的声明。</p>
<p>案例：实现函数类部的冒泡排序(c++实现，同学们用c来做一遍)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//maopao.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, a[<span class="number">1000</span>];</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;<span class="comment">//输入n个数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//冒泡，不断比较相邻的两个数，如果顺序错了，那么就交换</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n-i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[j<span class="number">-1</span>] &gt; a[j])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = a[j];</span><br><span class="line">                a[j] = a[j<span class="number">-1</span>];</span><br><span class="line">                a[j<span class="number">-1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//依次输出</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; a[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>指针</code>：指针是个地址，它是内存中一段数据的地址。可以理解就是指针就是变量，数值是地址</p>
<p>思考问题：数组和指针有什么关联，又有什么区别呢？</p>
<p>数组名是数组的首地址。</p>
<p><strong><em>数组指针和指针数组</em></strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">2</span>][<span class="number">3</span>] = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;&#125;;</span><br><span class="line">    <span class="comment">//数组指针（也称行指针）</span></span><br><span class="line">    <span class="comment">//int (*p)[n]; p是一个指针，指向一个整型的一维数组，这个一维数组的长度是n</span></span><br><span class="line">    <span class="keyword">int</span> (*array_p)[<span class="number">3</span>] = <span class="built_in">array</span>; <span class="comment">//指针可以++，++代表移位 </span></span><br><span class="line">    <span class="comment">//取出5</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) array_p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) (array_p + <span class="number">1</span>));</span><br><span class="line">    <span class="comment">//printf("%x\n", (unsigned int) (array_p + 2));</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"取出2元素==&gt;%d\n"</span>,*(*(array_p+<span class="number">0</span>)+<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通遍历</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="built_in">array</span>[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//求二维数组元素的最大值。</span></span><br><span class="line">    <span class="keyword">int</span> *p,max;</span><br><span class="line">    <span class="keyword">for</span>(p=<span class="built_in">array</span>[<span class="number">0</span>],max=*p;p&lt;<span class="built_in">array</span>[<span class="number">0</span>]+<span class="number">6</span>;p++)</span><br><span class="line">        <span class="keyword">if</span>(*p&gt;max)</span><br><span class="line">            max=*p;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"MAX=%d"</span>,max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案列2：代码分析</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> *a,*b;</span><br><span class="line">   a = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">   b = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">   *a = <span class="number">100</span>;</span><br><span class="line">   *b = <span class="number">200</span>;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">"a的地址是:%p,%p,%d\n"</span>,&amp;a,a,*a); <span class="comment">//地址空间占用8个字节</span></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">"b的地址是:%p,%p,%d\n"</span>,&amp;b,b,*b);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> c[<span class="number">3</span>] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>&#125;; <span class="comment">//计算机中 数组就是一个地址了，注意和变量的区别</span></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">"c的地址是:%p,%p,%d,%d,%d\n"</span>,&amp;c,c,c[<span class="number">0</span>],c[<span class="number">1</span>],c[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>操作系统管理内存原理</code>：</p>
<p>栈空间：堆空间：内存映射：</p>
<p>stack由系统自动分配，heap需要程序员自己申请，C中用函数malloc分配空间，用free释放，C++用new分配，用delete释放。对于堆空间来说，默认是没有软限制的，只依赖硬限制。栈空间可以通过ulimit -a命令进行查找。</p>
<p>内存泄漏：申请的内存一直申请不释放。</p>
<p>野指针：占用别的程序申请的内存。</p>
<p><code>函数指针</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> x)</span></span>;<span class="comment">/*申明一个函数*/</span></span><br><span class="line"><span class="keyword">int</span> (*f)(<span class="keyword">int</span> x);<span class="comment">/*申明一个函数指针*/</span></span><br><span class="line">f = func;<span class="comment">/*将函数func的首地址赋值给f*/</span></span><br></pre></td></tr></table></figure>
<p><code>指针强化问题</code>:</p>
<ul>
<li>理解指针关键在内存，没有内存哪来的内存首地址，没有内存首地址，哪来的指针啊。</li>
<li>指针也是一种数据类型，指针的数据类型是指它所指向内存空间的数据类型。</li>
<li>指针指向谁就把谁的地址赋给指针。</li>
<li>间接赋值（*p）是指针存在的最大意义 。</li>
</ul>
<p>案列3：间接赋值 指针推导</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针做函数参数间接改变我们的运算结果</span></span><br><span class="line"><span class="comment">//int getFoleLen(int*p)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    *p = 40;</span></span><br><span class="line"><span class="comment">//    return true;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">////这样只能修改形参的值  不能改变实参的值</span></span><br><span class="line"><span class="comment">////不通过操作地址的话  编译器是将实参的值复制给形参 而不是把实参传递进来</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getFoleLen</span><span class="params">(<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//形参变量和函数里面的变量本质是一样的  只不过形参变量具有对外的属性</span></span><br><span class="line">    b = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">////return只能返回一个结果</span></span><br><span class="line"><span class="comment">//int getFoleLen()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    int a = 100;</span></span><br><span class="line"><span class="comment">//    return a;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一级指针到0级指针</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//修改a的值</span></span><br><span class="line">    <span class="comment">//直接修改</span></span><br><span class="line">    a = <span class="number">12</span>;</span><br><span class="line">    <span class="comment">//间接修改</span></span><br><span class="line">    p = &amp;a;</span><br><span class="line">    *p = <span class="number">20</span>;<span class="comment">//p的值是a的地址 *就像一把钥匙  通过地址 找到一块内存空间  就间接修改了a的值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a,%d\n"</span>, a);</span><br><span class="line">    getFoleLen(&amp;a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a1,%d\n"</span>,a);</span><br><span class="line">    getFoleLen(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a2,%d\n"</span>, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="指针细节总结"><a href="#指针细节总结" class="headerlink" title="指针细节总结"></a>指针细节总结</h3><p>指针到底是什么？本质是什么？</p>
<p>指针组合背诵：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">"jesson"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *p = str;</span><br><span class="line">    <span class="comment">// p[0] = 'a'; 不能通过指针修改char的内容</span></span><br><span class="line">    <span class="keyword">char</span> <span class="keyword">const</span> *p3 = str; <span class="comment">//和上面一样的 const 只能修饰char</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> * <span class="keyword">const</span> p4 = str;</span><br><span class="line">    p4[<span class="number">0</span>] = <span class="string">'a'</span>;<span class="comment">//能通过指针修改char的内容</span></span><br><span class="line">    <span class="comment">//p4 = "sfsdf";</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span>  <span class="keyword">char</span> * <span class="keyword">const</span> p5 = str;</span><br><span class="line">    <span class="keyword">char</span>   <span class="keyword">const</span> * <span class="keyword">const</span> p6 = str;</span><br><span class="line"><span class="comment">//    p5[0] = 'a';</span></span><br><span class="line"><span class="comment">//    p6[0] = 'a';</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回归本质，char* p = null。本质上指针就是一个变量，一般来说含有指针的变量我们称之为指针变量，指针变量占用4个字节。注意指针变量和它指向的内存块是两个不同的概念。分析一个简短的代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *a = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">100</span>;</span><br><span class="line">a = &amp;b;</span><br><span class="line">*a = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">int</span> c =<span class="number">0</span>;</span><br><span class="line">c = *a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"b的数值是：%d,a的数值是：%d,C的数值是：%d"</span>,b,*a,c); <span class="comment">//间接修改变量的数值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> * str = getStr();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"字符信息是：%s\n"</span>,str);</span><br><span class="line">*(str+<span class="number">1</span>)=<span class="string">'r'</span>; <span class="comment">//str指向的是常量池，这里肯定会报错</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"字符信息是：%s\n"</span>,str);</span><br></pre></td></tr></table></figure>
<p>为什么C语言要设计指针？指针的最重要的作用是什么？<strong><em>答案就是—&gt;间接赋值</em></strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getlength</span><span class="params">(<span class="keyword">int</span>* p)</span></span>&#123;</span><br><span class="line">    *p = <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> *p = <span class="literal">NULL</span>;</span><br><span class="line">    p = &amp;a;</span><br><span class="line">    *p = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a的数值是：%d"</span>,a);</span><br><span class="line">    getlength(p); <span class="comment">//是不是通过函数来间接修改其他变量的数值？形参可以修改实参的数值，这就是指针的魅力</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a的数值是：%d"</span>,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再来看看多级指针？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> *p = &amp;i;</span><br><span class="line">    <span class="keyword">int</span> **q = &amp;p;</span><br><span class="line">    <span class="keyword">int</span> ***r = &amp;q;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"i = %d\n"</span>, ***r); <span class="comment">//10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案列3：二级指针操作文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readFileData</span><span class="params">(FILE *pFILE, <span class="keyword">int</span> num, <span class="keyword">char</span> **pString)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printData</span><span class="params">(<span class="keyword">char</span> **pString, <span class="keyword">int</span> num)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getFilelinenum</span><span class="params">(FILE* file)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(file ==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"文件打开失败"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">1024</span>];<span class="comment">//定义1024缓冲区</span></span><br><span class="line">    <span class="keyword">while</span>(fgets(buff,<span class="number">1024</span>,file)!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s"</span>,buff);</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param pFILE  文件指针</span></span><br><span class="line"><span class="comment"> * @param num 有效行数</span></span><br><span class="line"><span class="comment"> * @param pString 把有效的数据放到堆区</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readFileData</span><span class="params">(FILE *pFILE, <span class="keyword">int</span> num, <span class="keyword">char</span> **pString)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pFILE ==<span class="literal">NULL</span>||num&lt;<span class="number">0</span>||pString==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"参数错误"</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> index =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">1024</span>];<span class="comment">//定义1024缓冲区</span></span><br><span class="line">    <span class="keyword">while</span>(fgets(buff,<span class="number">1024</span>,pFILE)!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> currentLen = <span class="built_in">strlen</span>(buff)+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">char</span> * current = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>*)*currentLen);</span><br><span class="line">        <span class="built_in">strcpy</span>(current,buff);</span><br><span class="line">        pString[index++] = current;</span><br><span class="line">        <span class="comment">//清空缓冲区</span></span><br><span class="line">        <span class="built_in">memset</span>(buff,<span class="number">0</span>,<span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printData</span><span class="params">(<span class="keyword">char</span> **pString, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"第%d行的数据是%s"</span>,i+<span class="number">1</span>,pString[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"======BEGIN=========\n"</span>);</span><br><span class="line">    FILE* file = fopen(<span class="string">"../test.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">    <span class="keyword">if</span>(file == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"文件打开失败"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//注意这里把函数注释掉，程序就好了，为什么？要学员思考？(文件指针移动)</span></span><br><span class="line">   <span class="comment">// int num = getFilelinenum(file);</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">char</span>** pArrays = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>*)*num);</span><br><span class="line">    readFileData(file,num,pArrays);</span><br><span class="line">    printData(pArrays,num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案列4：二级指针作为函数参数的输出特性</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//释放内存给大家做</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testfunction</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">allocaMem</span><span class="params">(<span class="keyword">int</span> **pInt)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span> **pInt, <span class="keyword">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"======BEGIN=========\n"</span>);</span><br><span class="line">    testfunction();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testfunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* p = <span class="literal">NULL</span>;</span><br><span class="line">    allocaMem(&amp;p);</span><br><span class="line">    printArray(&amp;p,<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span> **p, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,(*p)[j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">allocaMem</span><span class="params">(<span class="keyword">int</span> **p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* arr = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        arr[i] = i+<span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    *p = arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>可变函数<br>stdarg.h头文件正是解决这个问题而生，不过其用法比较繁琐，必须按照如下步骤进行： </li>
</ul>
<ol>
<li>一个使用省略号的函数原型； </li>
<li>在函数定义中创建一个va_list类型的变量； </li>
<li>用宏把该变量初始化为一个参数列表； </li>
<li>用宏访问参数列表； </li>
<li>用宏清理</li>
</ol>
<p>该函数原型必须有一个形参和一个省略号，例如：</p>
<p>void foo1(int lim, …);                //有效<br>void foo2(const char *s, int k, …);   //有效<br>char foo3(char c1, … , char c2);      //无效，省略后不在后面<br>double foo4(…);                       //无效，没有形参</p>
<p>参见代码 函数.c</p>
<ul>
<li>函数指针</li>
</ul>
<p><strong>函数指针变量</strong></p>
<p>​     一个数据变量的内存地址可以存储在相应的指针变量中，函数的首地址也以存储在某个函数指针变量中。这样，我就可以通过这个函数指针变量来调用所指向的函数了。</p>
<p>​     在C系列语言中，任何一个变量，总是要先声明，之后才能使用的。函数指针变量也应该要先声明。</p>
<p>​     函数指针变量的声明：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (*funP)(<span class="keyword">int</span>) ;   <span class="comment">//声明一个指向同样参数、返回值的函数指针变量。</span></span><br></pre></td></tr></table></figure>
<h3 id="预处理器"><a href="#预处理器" class="headerlink" title="预处理器"></a>预处理器</h3><p><strong>C 预处理器</strong>不是编译器的组成部分，但是它是编译过程中一个单独的步骤。简言之，C 预处理器只不过是一个==文本替换==工具而已，他们会指示编译器在实际编译之前完成所需的预处理。我们将把 C 预处理器（C Preprocessor）简写为 CPP。</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>#define</td>
<td>定义宏</td>
</tr>
<tr>
<td>#include</td>
<td>包含一个源代码文件</td>
</tr>
<tr>
<td>#undef</td>
<td>取消已定义的宏</td>
</tr>
<tr>
<td>#ifdef</td>
<td>如果宏已经定义，则返回真</td>
</tr>
<tr>
<td>#ifndef</td>
<td>如果宏没有定义，则返回真</td>
</tr>
<tr>
<td>#if</td>
<td>如果给定条件为真，则编译下面代码</td>
</tr>
<tr>
<td>#else</td>
<td>#if 的替代方案</td>
</tr>
<tr>
<td>#elif</td>
<td>如果前面的 #if 给定条件不为真，当前条件为真，则编译下面代码</td>
</tr>
<tr>
<td>#endif</td>
<td>结束一个 #if……#else 条件编译块</td>
</tr>
<tr>
<td>#error</td>
<td>当遇到标准错误时，输出错误消息</td>
</tr>
<tr>
<td>#pragma</td>
<td>使用标准化方法，向编译器发布特殊的命令到编译器中</td>
</tr>
</tbody>
</table>
<p>常用举例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_ARRAY_LENGTH 20</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"myheader.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MESSAGE</span></span><br><span class="line">   <span class="meta">#<span class="meta-keyword">define</span> MESSAGE <span class="meta-string">"You wish!"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"File :%s\n"</span>, __FILE__ );</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Date :%s\n"</span>, __DATE__ );</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Time :%s\n"</span>, __TIME__ );</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Line :%d\n"</span>, __LINE__ );</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"ANSI :%d\n"</span>, __STDC__ );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(OS_UNIX)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> OPTION1</span></span><br><span class="line">      unix_version_of_option1();</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> OPTION2</span></span><br><span class="line">      unix_version_of_option2();</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(OS_MDOS)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> OPTION2</span></span><br><span class="line">          msdos_version_of_option2();</span><br><span class="line">   <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="字符串函数和指向字符串指针总结"><a href="#字符串函数和指向字符串指针总结" class="headerlink" title="字符串函数和指向字符串指针总结"></a>字符串函数和指向字符串指针总结</h3><p>C语言中提供了大量丰富的字符串处理函数，大致可以分为字符串的输入，输出，合并，修改，比较，转换，复制，搜索等几类。 用于输入输出的函数包含在stdio.h中而其他的字符串处理函数一般包含在string.h中。下面是编程中常用的函数，需要掌握。</p>
<ul>
<li><p>字符串的输出函数<br>int puts(char const*strPtr);<br>输出字符串到显示器中去，传入的实参可以是字符串数组也也可以是字符指针<br>一般情况下我们用fputs来代替</p>
</li>
<li><p>字符串的输入函数<br>char <em>gets(char </em>strptr);<br>char *fgets();<br>从标准键盘输入一个字符串存放到指针strptr指向的字符数组，一般我们使用fgets来操作</p>
</li>
<li><p>获取字符串的长度<br>int strlen(char const*string);<br>获取字符串的长度，返回的是字符的个数，但是不会包括’\0’,结束符</p>
</li>
<li><p>字符串拷贝函数<br>char <em>strcpy(char</em>des,char<em>src);<br>char </em>strncpy(char <em>des,char </em>src,int size);<br>将src指向的字符串拷贝到des指向的字符串数组中去，结束符也一同进行拷贝，size参数也可以拷贝制定长度的字符串，建议des为字符数组<br>注意:目标尽量使用字符数组，因为如果是字符指针的话，分配的内存在常量池中，是不允许进行改变的，容易造成段错误</p>
</li>
<li><p>字符串的连接函数<br>char <em> strcat(const </em>char str1,const <em>char str2);<br>char </em>strncat(const <em>char str1,const </em>char str2,int size);<br>将str2指向的字符串连接到str1指向的字符后面，同时会删除str1后面的’\0’,返回的是str1指向字符串的首地址重点内容</p>
</li>
<li><p>字符串比较函数<br>int strcmp(const char <em> str1,const char </em>str2);<br>int strncmp(const char<em>str1,const char </em>str2,int size);<br>按照ascii码来进行比较，并由函数返回值进行判断<br>返回0,字符串1等于字符串2,<br>大于0,字符串1大于字符串2,<br>小于0,字符串1小于字符串2,</p>
</li>
<li><p>字符串分割函数<br>char<em> strtok(char </em>str,const char *delimiters);<br>根据delimiters指向的分割符号，将str指向的字符串分割成若干个子字符串，同时返回的是分割出的子字符串</p>
</li>
<li><p>字符串中是否包含字符<br>char <em> strchr(const char </em>,int c);//从做往右寻找字符c<br>char <em> strrchr(const char </em>,int c); //从有往左开始寻找字符c<br>判断字符串中是否包含字符串；</p>
</li>
<li><p>内存的初始化<br>memset(void *s,int c,size_t n);</p>
</li>
<li><p>内存的拷贝 </p>
</li>
</ul>
<p>​    memcpy(void <em>des,void </em>src ,size_t ,n);</p>
<p>代码实战：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str_array[<span class="number">20</span>] = &#123;<span class="string">'\0'</span>&#125;;</span><br><span class="line">    <span class="comment">//gets(str_array);</span></span><br><span class="line">    <span class="comment">//puts(str_array);</span></span><br><span class="line"></span><br><span class="line">    fgets(str_array,<span class="keyword">sizeof</span>(str_array),<span class="built_in">stdin</span>);<span class="comment">//从标准输入中读入字节数-1个字节的字符</span></span><br><span class="line">    <span class="built_in">fputs</span>(str_array,<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *ptr_string = <span class="string">"helloworld"</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ptr_string len:%d\n"</span>,<span class="built_in">strlen</span>(ptr_string));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"==============strcpy==================\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> str_array2[<span class="number">20</span>] = &#123;<span class="string">'\0'</span>&#125;;</span><br><span class="line">    <span class="built_in">strcpy</span>(str_array2,ptr_string);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"str_array2:%s\n"</span>,str_array2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"---------------------------\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> str_array3[<span class="number">10</span>] = &#123;<span class="string">"1234567890"</span>&#125;;</span><br><span class="line">    <span class="built_in">strncpy</span>(str_array3,ptr_string,<span class="number">7</span>);<span class="comment">//将ptr_str的前7位拷贝进去</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"str_array3:%s\n"</span>,str_array3);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"===============strcmp===============\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *ptr_string_1 = <span class="string">"helloworld"</span>;</span><br><span class="line">    <span class="keyword">char</span> *ptr_string_2 = <span class="string">"helloworld"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"value:%d\n"</span>,<span class="built_in">strcmp</span>(ptr_string_1,ptr_string_2));<span class="comment">//等于0相等，大于零，即前一个大于后一个，小于0,前一个小于后一个，按ascii码比较</span></span><br><span class="line">    <span class="keyword">char</span> *ptr_string_3 = <span class="string">"nuli"</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"value:%d\n"</span>,<span class="built_in">strcmp</span>(ptr_string_3,ptr_string_2));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"=============strcat=================\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> str_array4[<span class="number">10</span>] = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="built_in">strcat</span>(str_array4,str_array3);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"str_array4:%s\n"</span>,str_array4);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"============strchr=================\n"</span>);<span class="comment">//判断字符串中是否包含字符，返回的是这个字符的指针(从左往右边)</span></span><br><span class="line">    <span class="keyword">char</span> *ptr_string_4 = <span class="built_in">strchr</span>(str_array4,<span class="string">'l'</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ptr_string4:%s,%c\n"</span>,ptr_string_4,*ptr_string_4);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *ptr_string_5 = <span class="built_in">strrchr</span>(str_array4,<span class="string">'l'</span>);<span class="comment">//从右往左寻找</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ptr_string4:%s,%c\n"</span>,ptr_string_5,*ptr_string_5);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strchr</span>(ptr_string_5,<span class="string">'o'</span>)!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ptr_string_5 contains o!\n"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ptr_string_5 not contains o!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"==================strstr===========\n"</span>);<span class="comment">//字符串中是否包含另外一个字符串</span></span><br><span class="line">    <span class="keyword">char</span> *str9 = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="keyword">char</span> *str10 = <span class="string">"first helloworld"</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strstr</span>(str10,str9) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"str10 contains str9\n"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"str10 not contains str9\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"=================strtok=============\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> str[] =<span class="string">"hello:zzf:hello:tom"</span>;</span><br><span class="line">    <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> *p = strtok(str,<span class="string">":"</span>);</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        counter++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s"</span>,p);</span><br><span class="line">        p = strtok(<span class="literal">NULL</span>,<span class="string">":"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"================memset,memcpy=========="</span>);<span class="comment">//内存清空和拷贝</span></span><br><span class="line">    <span class="keyword">char</span> src[] = <span class="string">"i love you"</span>;</span><br><span class="line">    <span class="keyword">char</span> des[] = <span class="string">"you love me"</span>;</span><br><span class="line">    <span class="built_in">memset</span>(des,<span class="number">0</span>,<span class="keyword">sizeof</span>(des));<span class="comment">//清空或者初始化</span></span><br><span class="line">    <span class="built_in">memcpy</span>(des,src,<span class="keyword">sizeof</span>(des)<span class="number">-1</span>);<span class="comment">//拷贝des字节数-1,最后一个符号用于存储结束符号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>自己需要思考？自己如何实现C的库函数？</em></strong></p>
<p>我们来实现几个吧？学习要善于思考啊。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;printf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mystrlen</span><span class="params">(<span class="keyword">char</span> *s1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">teststrcat</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">mystrcat</span><span class="params">(<span class="keyword">char</span>* dest, <span class="keyword">const</span> <span class="keyword">char</span>* str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">mystrstr</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* dest, <span class="keyword">const</span> <span class="keyword">char</span>* str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testfindStr</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* s1 = <span class="string">"jesson"</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = mystrlen(s1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"字符串长度为%d"</span>, ret);</span><br><span class="line">    teststrcat();</span><br><span class="line">    testfindStr();</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testfindStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* s1 = <span class="string">"abcdefgh"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* s2 = <span class="string">"ab"</span>;</span><br><span class="line">    <span class="keyword">char</span>* ch = mystrstr(s1, s2);</span><br><span class="line">    <span class="keyword">if</span> (ch != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, ch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"not exist\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">teststrcat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">20</span>] = <span class="string">"abcde"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* s2 = <span class="string">"fghil"</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, mystrcat(s1, s2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mystrlen</span><span class="params">(<span class="keyword">char</span> *s1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (*s1!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">        *s1++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char* strcat(char* dest, const char* str)</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">mystrcat</span><span class="params">(<span class="keyword">char</span>* dest, <span class="keyword">const</span> <span class="keyword">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    assert(dest);</span><br><span class="line">    assert(str);</span><br><span class="line">    <span class="keyword">char</span> *ret = dest;</span><br><span class="line">    <span class="keyword">while</span> (*dest)</span><br><span class="line">    &#123;</span><br><span class="line">        dest++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (*dest++ = *str++)</span><br><span class="line">    &#123;</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char* strstr(const char* dest, const char* str)</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">mystrstr</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* dest, <span class="keyword">const</span> <span class="keyword">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* ptr = dest;</span><br><span class="line">    <span class="keyword">char</span>* p1 = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">char</span>* p2 = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (*dest)</span><br><span class="line">    &#123;</span><br><span class="line">        p1 = ptr;</span><br><span class="line">        p2 = str;</span><br><span class="line">        <span class="keyword">while</span> (*p1++ == *p2++)</span><br><span class="line">        &#123;</span><br><span class="line">            p1++;</span><br><span class="line">            p2++;</span><br><span class="line">            <span class="keyword">if</span> (*p2==<span class="string">'\0'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ptr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ptr++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>C 数组允许定义可存储相同类型数据项的变量，结构体是 C 语言中另一种用户自定义的可用的数据类型，它允许您存储不同类型的数据项。</p>
<p>定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> [<span class="title">structure</span> <span class="title">tag</span>]</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   member definition;</span><br><span class="line">   member definition;</span><br><span class="line">   ...</span><br><span class="line">   member definition;</span><br><span class="line">&#125; [one <span class="keyword">or</span> more structure variables];</span><br></pre></td></tr></table></figure>
<p>如何使用？简单回忆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体是一种构造数据类型</span></span><br><span class="line"><span class="comment">//把不同的数据类型整合起来成为一个自定义的数据类型</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Man</span> &#123;</span></span><br><span class="line">    <span class="comment">//成员</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//初始化结构体的变量</span></span><br><span class="line">    <span class="comment">//第一种方式 </span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Man</span> <span class="title">m1</span> = &#123;</span><span class="string">"Jack"</span>,<span class="number">21</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s，%d \n"</span>, m1.name, m1.age);</span><br><span class="line">    <span class="comment">//第二种方式</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Man</span> <span class="title">m2</span>;</span></span><br><span class="line">    </span><br><span class="line">    m2.age = <span class="number">23</span>;</span><br><span class="line">    <span class="comment">//m2.name = "rose"; 不能这样赋值</span></span><br><span class="line">    <span class="built_in">strcpy</span>(m2.name, <span class="string">"rose"</span>);</span><br><span class="line">    <span class="comment">//或者</span></span><br><span class="line">    <span class="comment">//sprintf(m2.name, "Jason");</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//不能再赋值</span></span><br><span class="line">    <span class="comment">//m1 = &#123;&#125;;//类似JavaScript字面量赋值，只能在变量声明时赋值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s，%d"</span>, m2.name, m2.age);</span><br><span class="line">    getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结构体的嵌套：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> <span class="title">t</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//字面量的方式</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">s1</span> = &#123;</span> <span class="string">"jack"</span> ,<span class="number">21</span>,&#123;<span class="string">"Jeason"</span>&#125; &#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s，%d, %s\n"</span>, s1.name, s1.age, s1.t.name);</span><br><span class="line">   <span class="comment">// system("pause");</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结构体指针：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> <span class="title">t</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//字面量的方式</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">s1</span> = &#123;</span> <span class="string">"jack"</span> ,<span class="number">21</span>,&#123;<span class="string">"Jeason"</span>&#125; &#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s，%d, %s\n"</span>, s1.name, s1.age, s1.t.name);</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>高级知识总结：</p>
<p>==铁律1==: 每个结构体成员的起始地址为该成员大小的整数倍，即int型成员的其实地址只能为0、4、8等</p>
<p>==铁律2==: 结构体的大小为其中最大成员大小的整数倍</p>
<p>1，数据类型自身对齐</p>
<p>数据类型的起始地址为其大小的整数倍</p>
<p>2，结构体的自身对齐</p>
<p>结构体的自身对齐值为其中最大的成员大小</p>
<p>3，指定对齐</p>
<p>可以使用关键词#pragma pack(1) 来指定结构体的对齐值</p>
<p>4，有效对齐值</p>
<p>有效对齐值为自身对齐值与指定对齐值中较小的一个。（即指定对齐值超过自身对齐值无意义）</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0wokstldlj30t807w3z1.jpg" alt="image-20190309174101650"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="comment">//char 1字节、short 2字节、int 4字节</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1，每个结构体成员的起始地址为该成员大小的整数倍，即int型成员的其实地址只能为0、4、8等</span></span><br><span class="line"><span class="comment">//2，结构体的大小为其中最大成员大小的整数倍</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(10)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> a; <span class="comment">//1</span></span><br><span class="line">    <span class="keyword">int</span> b; <span class="comment">//3+4= 7 （规则1）</span></span><br><span class="line">    <span class="keyword">short</span> c; <span class="comment">//2+2 （规则2）</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(10)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> a; <span class="comment">//1</span></span><br><span class="line">    <span class="keyword">short</span> b; <span class="comment">//1+2</span></span><br><span class="line">    <span class="keyword">int</span> c; <span class="comment">//4</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(struct A)=%d, sizeof(struct B)=%d\n"</span>, <span class="keyword">sizeof</span>(struct A), <span class="keyword">sizeof</span>(struct B));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件I-O"><a href="#文件I-O" class="headerlink" title="文件I/O"></a>文件I/O</h3><ul>
<li>打开文件</li>
</ul>
<p>可以使用 <strong>fopen( )</strong> 函数来创建一个新的文件或者打开一个已有的文件，这个调用会初始化类型 <strong>FILE</strong> 的一个对象，类型 <strong>FILE</strong> 包含了所有用来控制流的必要的信息。下面是这个函数调用的原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FILE *<span class="title">fopen</span><span class="params">( <span class="keyword">const</span> <span class="keyword">char</span> * filename, <span class="keyword">const</span> <span class="keyword">char</span> * mode )</span></span>;</span><br></pre></td></tr></table></figure>
<p>在这里，<strong>filename</strong> 是字符串，用来命名文件，访问模式 <strong>mode</strong> 的值可以是下列值中的一个：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>打开一个已有的文本文件，允许读取文件。</td>
</tr>
<tr>
<td>w</td>
<td>打开一个文本文件，允许写入文件。如果文件不存在，则会创建一个新文件。在这里，您的程序会从文件的开头写入内容。如果文件存在，则该会被截断为零长度，重新写入。</td>
</tr>
<tr>
<td>a</td>
<td>打开一个文本文件，以追加模式写入文件。如果文件不存在，则会创建一个新文件。在这里，您的程序会在已有的文件内容中追加内容。</td>
</tr>
<tr>
<td>r+</td>
<td>打开一个文本文件，允许读写文件。</td>
</tr>
<tr>
<td>w+</td>
<td>打开一个文本文件，允许读写文件。如果文件已存在，则文件会被截断为零长度，如果文件不存在，则会创建一个新文件。</td>
</tr>
<tr>
<td>a+</td>
<td>打开一个文本文件，允许读写文件。如果文件不存在，则会创建一个新文件。读取会从文件的开头开始，写入则只能是追加模式。</td>
</tr>
</tbody>
</table>
<p>如果处理的是二进制文件，则需使用下面的访问模式来取代上面的访问模式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"rb"</span>, <span class="string">"wb"</span>, <span class="string">"ab"</span>, <span class="string">"rb+"</span>, <span class="string">"r+b"</span>, <span class="string">"wb+"</span>, <span class="string">"w+b"</span>, <span class="string">"ab+"</span>, <span class="string">"a+b"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>关闭文件</li>
</ul>
<p>为了关闭文件，请使用 fclose( ) 函数。函数的原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fclose</span><span class="params">( FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure>
<p>如果成功关闭文件，<strong>fclose( )</strong> 函数返回零，如果关闭文件时发生错误，函数返回 <strong>EOF</strong>。这个函数实际上，会清空缓冲区中的数据，关闭文件，并释放用于该文件的所有内存。EOF 是一个定义在头文件 <strong>stdio.h</strong> 中的常量。</p>
<p>C 标准库提供了各种函数来按字符或者以固定长度字符串的形式读写文件。</p>
<ul>
<li>写入文件</li>
</ul>
<p>下面是把字符写入到流中的最简单的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputc</span><span class="params">( <span class="keyword">int</span> c, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure>
<p>函数 <strong>fputc()</strong> 把参数 c 的字符值写入到 fp 所指向的输出流中。如果写入成功，它会返回写入的字符，如果发生错误，则会返回 <strong>EOF</strong>。您可以使用下面的函数来把一个以 null 结尾的字符串写入到流中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputs</span><span class="params">( <span class="keyword">const</span> <span class="keyword">char</span> *s, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure>
<p>函数 <strong>fputs()</strong> 把字符串 <strong>s</strong> 写入到 fp 所指向的输出流中。如果写入成功，它会返回一个非负值，如果发生错误，则会返回 <strong>EOF</strong>。您也可以使用 <strong>int fprintf(FILE *fp,const char *format, …)</strong> 函数来写把一个字符串写入到文件中。</p>
<ul>
<li>读取文件</li>
</ul>
<p>下面是从文件读取单个字符的最简单的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fgetc</span><span class="params">( FILE * fp )</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>fgetc()</strong> 函数从 fp 所指向的输入文件中读取一个字符。返回值是读取的字符，如果发生错误则返回 <strong>EOF</strong>。下面的函数允许您从流中读取一个字符串：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">fgets</span><span class="params">( <span class="keyword">char</span> *buf, <span class="keyword">int</span> n, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure>
<p>函数 <strong>fgets()</strong> 从 fp 所指向的输入流中读取 n - 1 个字符。它会把读取的字符串复制到缓冲区 <strong>buf</strong>，并在最后追加一个 <strong>null</strong> 字符来终止字符串。</p>
<ul>
<li>二进制 I/O 函数</li>
</ul>
<p>下面两个函数用于二进制输入和输出：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> fread(<span class="keyword">void</span> *ptr, <span class="keyword">size_t</span> size_of_elements, <span class="keyword">size_t</span> number_of_elements, FILE *a_file);                </span><br><span class="line"><span class="keyword">size_t</span> fwrite(<span class="keyword">const</span> <span class="keyword">void</span> *ptr, <span class="keyword">size_t</span> size_of_elements, <span class="keyword">size_t</span> number_of_elements, FILE *a_file);</span><br></pre></td></tr></table></figure>
<p>这两个函数都是用于存储块的读写 - 通常是数组或结构体。</p>
<p>案例1：仿照zookeeper组件实现配置文件的读写功能。参见项目配置文件项目</p>
<p>案例2：文件加密/解密  我使用的是异或，同学们自己在实现一种 想象aes ?</p>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2019/03/22/C-学习心得-一/">C++学习心得(一)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categorías</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Etiquetas</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recientes</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/22/C学习心得-一/">C学习心得(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/22/C-学习心得-一/">C++学习心得(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/01/关于IM通讯的研究/">关于IM通讯的研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/万能接口的使用/">万能接口的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/对事件分发机制的一些理解/">对事件分发机制的一些理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/28/手写EventBus框架/">手写EventBus框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/25/安卓跨进程间通讯的研究/">安卓跨进程间通讯的研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/14/安卓性能优化工具/">安卓性能优化工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/10/LRU算法的研究/">LRU算法的研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/02/2018总结之Gradle/">2018总结之Gradle</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">既以歌声惊天下 何必起舞乱芳华.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>